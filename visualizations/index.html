<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>MinnPost</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
<script type='text/javascript' src='//s7.addthis.com/js/250/addthis_widget.js#async=1'></script>
<link rel="shortcut icon" href="http://www.minnpost.com//sites/default/themes/siteskin/favicon.ico" type="image/x-icon" />
<meta name="keywords" content="Mark Dayton,Minnesota DFL,Minnesota GOP,Minnesota Legislature,Vikings Stadium,Voter ID Amendment" />
<meta name="description" content="  " />
<meta property="og:title" content="The 2012 Legislative session: What did they pass?"/>
<meta property="og:site_name" content="MinnPost"/>
<meta property="og:description" content="Explore bills by category, investigate which bills Gov. Dayton vetoed, and search by your legislators.
"/>
<meta property="og:image" content="http://www.minnpost.com/sites/default/files/images/thumbnails/fullpagearticles/BillExplorerGraphic3.png"/>
<link rel="apple-touch-icon" href="http://www.minnpost.com//sites/default/themes/siteskin/inc/images/apple-touch-icon.png" />
<meta name="viewport" content="width=device-width, initial-scale=1"></meta>


  <link type="text/css" rel="stylesheet" media="all" href="http://www.minnpost.com/sites/default/files/css/css_c4e767d2c0649831822044ff7e6893e5.css" />
<link type="text/css" rel="stylesheet" media="screen" href="http://www.minnpost.com/sites/default/files/css/css_6b2b28228f4e06a47e93d96b2abfeb4b.css" />
<link type="text/css" rel="stylesheet" media="print" href="http://www.minnpost.com/sites/default/files/css/css_93f63f4f94c282fd52e692fdfd1851a4.css" />
  <!--[if IE]>
      <link rel="stylesheet" href="http://www.minnpost.com/sites/default/themes/derma/inc/css/ie.css?8" type="text/css">
  <![endif]-->
    <script type="text/javascript" src="http://www.minnpost.com/sites/default/files/js/js_f2e939afce8e5c0712d11422afe6b703.js"></script>
    

</head>
<body class="not-front logged-in page-node node-type-article one-sidebar sidebar-right admin-nw admin-vertical admin-df  section-data section-data-id-2012 section-data-id-2012-id-05 section-data-id-2012-id-05-how-we-built-legislative-bill-explorer one-sidebar sidebar-right">
<div class="outside-embeddable-container">

  <!-- START: Embeddable -->
  <div class="node-body fieldlayout node-field-body">
    <style type="text/css">
      @import url('https://s3.amazonaws.com/data.minnpost/js/leaflet-master-20120531/leaflet.css');
      @import url('https://s3.amazonaws.com/data.minnpost/js/leaflet-addons-master-20120531/leaflet-addons.css');
    </style>
    
    <style type="text/css">
      #minnpost-2012-my-elections {
        max-width: 960px;
        margin: 0 auto;
      }
      .clear {
        clear: both;
      }
      
      .js-dependent,
      .hide {
        display: none;
      }
      
      .footnote {
        font-size: .75em;
        font-style: italic;
        color: #414141;
        margin-top: 1em;
      }
      
      .message-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        background-color: #FFFFFF;
      }
      .message-container .app-messages span {
        display: block;
        padding: .25em .5em;
        text-align: center;
        font-size: .75em;
        border-bottom: 1px solid #222222;
      }
      .message-container .app-messages span.error {
        color: red;
        border-color: red;
      }
      
      .welcome-section {
        text-align: center;
        padding: 2em;
        font-size: 1.5em;
      }
      
      .search-section {
        padding: 2em;
      }
      .search-section form {
        width: auto;
        padding: 0;
        margin: 0;
      }
      #address-input {
        width: 100%;
        font-size: 1.5em;
        padding: .25em .5em;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
      }
      #address-input.placeholder {
        color: #999999;
      }
      #search-submit {
        float: right;
      }
      
      .goto-search {
        display: block;
        margin-bottom: 1em;
      }
      
      .display-address,
      .display-lat-lon {
        color: #999999;
        font-size: .75em;
      }
      
      .list-block {
        margin-bottom: 2em;
      }
      
      .list-wrapper {
        float: left;
        width: 50%;
      }
      .list-wrapper-inner {
        margin-right: 1em;
      }
      .map-wrapper {
        float: right;
        width: 50%;
      }
      
      .election-list-container ul {
        list-style: none;
        margin: 1em 0 0 0;
        padding: 0;
      }
      .election-list-container ul li {
        width: 50%;
        float: left;
        list-style: none;
        margin: 0;
        padding: 0;
      }
      .election-list-container ul li a {
        display: block;
        padding: 0 .25em;
      }
      .election-list-container ul li a.active {
        background-color: #EBEBEB;
      }
      
      .list-wrapper .footnote {
        margin-top: 2em;
      }
      
      #election-map {
        border: 1px solid #EBEBEB;
        height: 400px;
      }
      
      .race-details-container .votesaver-ajax-title.node-title {
        font-family: NimbusSanNovConD-Bol,Helvetica,Arial,Geneva,sans-serif;
        font-weight: normal;
        font-style: normal;
        font-size: 215.4%;
        line-height: 1.15em;
        margin-bottom: .5em;
        text-align: center;
      }
      
      #minnpost-2012-my-elections .field-field-elections-f-candidates {
        padding-top: 1em;
        border-top: 1px solid #EBEBEB;
      }
      
      #minnpost-2012-my-elections .field-field-elections-district > .field-label {
        display: none;
      }
      #minnpost-2012-my-elections .field-field-elections-district .field-field-elections-pvi {
        width: 100%;
        float: none;
      }
      #minnpost-2012-my-elections .field-field-elections-district .field-field-elections-pvi .pvi {
        padding: 0 1em;
      }
      #minnpost-2012-my-elections .field-field-elections-district .field-field-elections-boundary-id {
        display: none;
      }
      #minnpost-2012-my-elections .field-field-elecitons-date {
        display: none;
      }
          
      .divider-container {
        border-top:2px solid #EBEBEB;
        position:relative;
        text-align:center;
        width: 85%;
        margin: 0 auto;
      }
      .divider-arrow-border {
        border-color: #EBEBEB transparent transparent transparent;
        border-style: solid;
        border-width: 30px;
        height:0;
        width:0;
        margin: 0 auto;
      }
      .divider-arrow {
        border-color: #FFFFFF transparent transparent transparent;
        border-style: solid;
        border-width: 30px;
        height:0;
        width:0;
        margin: -63px auto 0 auto;
      }
    </style>
    
    <!--[if lte IE 8]>
      <style type="text/css">
      	@import url('https://s3.amazonaws.com/data.minnpost/js/leaflet-master-20120531/leaflet.ie.css');
      	@import url('https://s3.amazonaws.com/data.minnpost/js/leaflet-addons-master-20120531/leaflet-addons.ie.css');
      </style>
    <![endif]-->
    
    <div id="minnpost-2012-my-elections">
      <div class="message-container">
        <div class="app-messages"></div>
      </div>
      
      <div class="section welcome-section">
        <noscript>
          <p>This application requires Javascript which is used to make your web browser more interactive.  If this message does not go away, please consider enabling Javascript.  Here are <a href="http://www.enable-javascript.com/" target="_blank">instructions on how to enable JavaScript in your web browser</a>.</p>
        </noscript>
        
        <p class="welcome-loading">Loading...</p>
      </div>
      
      <div class="section search-section hide">
        <h3>Search for a place in Minnesota to see what is on the ballot</h3>
        <form id="search-form" class="clear-block">
          <input type="text" id="address-input" class="form-text" title="Try entering your address" />
          <input type="submit" id="search-submit" class="form-submit" title="Search" value="Search" />
        </form>
        
        <h4>Or try out these places:</h4>
        <ul>
          <li><a href="#location/1,1">The State Capitol</a></li>
          <li><a href="#location/1,1">Duluth, MN</a></li>
        </ul>
      </div>
      
      <div class="section results-section hide">
        <a class="goto-search" href="#search">Go back to address search.</a>
        
        <div class="list-block clear-block">
          <div class="list-wrapper">
            <div class="list-wrapper-inner">
              <div class="location-results-container"></div>
              <div class="election-list-container clear-block"></div>
              <p class="footnote">Click on a race to see details and show the district on the map.</p>
            </div>
          </div>
          
          <div class="map-wrapper">
            <div class="map" id="election-map"></div>
          </div>
        </div>
        
        <div class="divider-container">
          <div class="divider-arrow-border"></div>
          <div class="divider-arrow"></div>
        </div>
        
        <div class="race-details-container"></div>
      </div>
      
      <p class="footnote">Election data provided by the <a href="http://www.sos.state.mn.us/" target="_blank">MN Secretary of State</a> supplemented with MinnPost data.  Geocoding provided by <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>.  Some map imagery provided by <a href="http://stamen.com" target="_blank">Stamen Design</a>.  Map data provided by <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> &copy; OpenStreetMap contributors.  District lookups provided by the <a href="http://boundaries.minnpost.com/" target="_blank">MinnPost Boundary Service</a>.</p>
      <p class="footnote">* Note that we are not including county level or local level races.  Please use the <a href="http://myballotmn.sos.state.mn.us/" target="_blank">MN Secretary of State's My Ballot</a> site to get a complete and official view of your races.</p>
    </div>
    
    <!-- Templates to be used in client side processing. -->
    <script id="template-location-results" type="text/template">
      <h3>Elections for this place*</h3>
      <% if (address) { %>
        <div class="display-address">Address: <%= address %></div>
      <% } %>
      <div class="display-lat-lon">Location: <%= lat %>, <%= lon %></div>
    </script>
    
    <script id="template-election-list" type="text/template">
      <ul>
        <% for (var i in elections) { %>
          <li><a href="#location/<%= lat %>,<%= lon %>/<%= elections[i].nid %>" data-boundary="<%= elections[i].boundary %>" data-nid="<%= elections[i].nid %>">
            <%= elections[i].title %>
          </a></li>
        <% } %>
      </ul>
    </script>
  
    <!-- jQuery if it is not there and jQueryCustom for Backbone --><!-- jQuery -->
    <script type="text/javascript">
      window.jQuery || document.write('<script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-1.3.2/jquery-1.3.2.min.js"><\/script>')
    </script>
    <!-- Leaflet and wax for mapping -->
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/leaflet-master-20120531/leaflet.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/leaflet-addons-master-20120531/leaflet-addons.min.js"></script>
    <!-- Underscore, a custom jquery, and backbone for app logic -->
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/underscore-1.3.3/underscore-min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-custom-master-20120606/jquery-1.7.2.custom.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/backbone-0.9.2/backbone-min.js"></script>
    
    
    <script type="text/javascript">
      jQueryCustom = jQueryCustom.noConflict();
      Backbone.setDomLibrary(jQueryCustom);
        
      (function($, w, undefined) {
        // View for searching
        var SearchView = Backbone.View.extend({
          // Various properties
          geocodeQuery: 'http://open.mapquestapi.com/nominatim/v1/search?format=json&json_callback=?&countrycodes=us&limit=1&q=',
          mnBounds: new L.LatLngBounds(
            new L.LatLng(43.499356, -97.239209), 
            new L.LatLng(49.384358, -89.489226)
          ),
          el: '.search-section',
          events: {
            'submit #search-form': 'submitSearch'
          },
          
          initialize: function() {
            this.router = this.options.router;
            this.$addressInput = $('#address-input');
            
            // Handle text input placeholder
            this.$addressInput.addClass('placeholder')
              .val(this.$addressInput.attr('title'));
            this.$addressInput.blur(function(e) {
              var $this = $(this);
              
              if ($this.val() === $this.attr('title')) {
                $this.addClass('placeholder');
              }
              if ($this.val() === '') {
                $this.addClass('placeholder')
                  .val($this.attr('title'));
              }
            });
            this.$addressInput.focus(function(e) {
              var $this = $(this);
              
              $this.removeClass('placeholder');
              if ($this.val() === $this.attr('title')) {
                $this.val('');
              }
            });
          },
          
          show: function() {
            $('.section').slideUp();
            this.$el.slideDown();
            this.$addressInput.blur();
            this.$addressInput.focus();
          },
          
          submitSearch: function(e) {
            e.preventDefault();
            this.router.removeMessage('all', 'error');
            
            if (this.$addressInput.val() === this.$addressInput.attr('title') ||
              this.$addressInput.val() === '') {
              this.router.message('Not a valid address', 'error');
            }
            else {
              this.geocodeAddress(this.$addressInput.val());
            }
          },
          
          geocodeAddress: function(address) {
            var thisView = this;
            
            this.router.message('Looking for your address.');
            $.getJSON(this.geocodeQuery + encodeURI(address), function(value) {
              thisView.router.removeMessage('Looking for your address.');
              
              // Use first response
              value = value[0];
              if (_.isUndefined(value)) {
                var message = 'We were unable turn your search terms, "' + address + '", into a geographical location.  Please be more specific, such as including ZIP code.';
                thisView.router.message(message, 'error');
              }
              // Check we are still mostly in Minnesota
              else if (!thisView.mnBounds.contains(new L.LatLng(value.lat, value.lon))) {
                var message = 'Sorry, but what you are looking for is outside of Minnesota.';
                thisView.router.message(message, 'error');
              }
              else {
                thisView.geocodeResults = value;
                thisView.addressFound(value.lat, value.lon);
              }
            });
          },
          
          addressFound: function(lat, lon) {
            this.router.navigate('/location/' + lat + ',' + lon, { trigger: true });
          }
        });
        
        // View for results
        var ResultsView = Backbone.View.extend({
          // Various properties
          mnBounds: new L.LatLngBounds(
            new L.LatLng(43.499356, -97.239209), 
            new L.LatLng(49.384358, -89.489226)
          ),
          boundaryQuery: 'http://boundaries.minnpost.com/1.0/boundary/?sets=%sets%&contains=%lat%,%lon%&callback=%callback%',
          boundarySets: 'congressional-districts-2012,counties-2010,county-commissioner-districts-2012,district-courts-2012,state-house-districts-2012,states-2011,state-senate-districts-2012',
          electionQuery: 'elections/api/election_boundary_search/%slugs%',
          electionDetailsQuery: 'elections/api/ajax/get_election/%id%',
          mapOptions: {
            minZoom: 4,
            maxZoom: 18,
            attributionControl: false
          },
          mapCenter: new L.LatLng(46.49839225859763, -93.6474609375),
          mapBaseTiles: new L.TileLayer(
            'http://{s}.tile.stamen.com/toner-lite/{z}/{x}/{y}.jpg', 
            { subdomains: ['a', 'b', 'c', 'd'] }
          ),
          mapHighlightStyle: {
            'color': '#801019',
            'weight': 3,
            'opacity': 0.9,
            'fill': true,
            'fillColor': '#801019',
            'fillOpacity': 0.5
          },
          
          el: '.results-section',
          events: {
          },
          
          initialize: function() {
            this.router = this.options.router;
            
            // Determine base path
            this.basePath = (!_.isUndefined(Drupal) && !_.isUndefined(Drupal.settings.basePath)) ? 
              Drupal.settings.basePath :
              ((w.location.hostname === 'localhost') ? '/minnpost/minnpostcom/' : '/');
          },
          
          show: function(location, race, open) {
            this.race = race;

            // Open only if there is change
            if (open) {
              $('.section').slideUp();
              this.$el.slideDown();
            }
            
            // Check if different location
            if (location.split(',')[0] != this.lat &&
              location.split(',')[1] != this.lon) {
              this.lat = location.split(',')[0];
              this.lon = location.split(',')[1];
              
              this.resetMap();
              this.resetElectionDetails();
              this.resetElections();
              
              this.updateCenterMap();
              this.showLocation();
              this.findBoundaries();
            }
            else if (!_.isUndefined(this.race)) {
              this.showElection();
            }
            else {
              this.resetMap();
              this.resetElectionDetails();
            }
          },
          
          findBoundaries: function() {
            var thisView = this;
            var request = this.boundaryQuery;
            request = request.replace('%sets%', encodeURI(this.boundarySets));
            request = request.replace('%lat%', encodeURI(this.lat));
            request = request.replace('%lon%', encodeURI(this.lon));
            request = request.replace('%callback%', encodeURI('boundaryCallback'));

            // Utilize a manual JSONP call so that the boundary
            // service can cache the results as well as the browser.
            w.boundaryCallback = function(value) {
              thisView.boundaries = value.objects;
              thisView.findElections();
              thisView.router.removeMessage('Looking for your districts. (may take a moment)');
            };

            this.router.message('Looking for your districts. (may take a moment)');
            $.ajax({
              url: request,
              dataType: 'script',
              cache: true
            });
          },
          
          findElections: function() {
            var thisView = this;
            var slugs = [];
            var request = '';

            // Make boundary query
            slugs = _.pluck(this.boundaries, 'slug');
            request = this.basePath + this.electionQuery.replace('%slugs%', encodeURI(slugs.join(',')));
          
            this.router.message('Looking for your elections.');
            $.getJSON(request, function(elections) {
              thisView.router.removeMessage('Looking for your elections.');
              thisView.elections = _.pluck(elections.nodes, 'node');
              thisView.showElections();
              thisView.showElection();
            });
          },
          
          showLocation: function() {
            $('.location-results-container').html(
              _.template($('#template-location-results').html(), {
                lat: this.lat,
                lon: this.lon,
                address: (!_.isUndefined(this.router.searchView.geocodeResults)) ?
                  this.router.searchView.geocodeResults.display_name : undefined
              }));
          },
          
          showElections: function() {
            $('.election-list-container').html(
              _.template($('#template-election-list').html(), {
                lat: this.lat,
                lon: this.lon,
                elections: this.elections
              }));
          },
          
          resetElections: function() {
            $('.election-list-container').html('');
          },
          
          resetElectionDetails: function() {
            $('.race-details-container').html('');
            $('.election-list-container ul li a').removeClass('active');
          },
          
          showElection: function() {
            var thisView = this;
            
            // Don't do anything if there is no race selected.
            if (!this.race) {
              return;
            }
            
            // Get pieces
            var e = _.find(this.elections, function(e) {  
              return e.nid === thisView.race;
            });
            var b = _.find(this.boundaries, function(b) {  
              return e.boundary === b.slug;
            });
            var geojson = {
              'type': 'Feature',
              'geometry': b.simple_shape
            }
            
            // Make or change highlight
            if (_.isObject(this.mapHighlight)) {
              this.map.removeLayer(this.mapHighlight);
            }
            
            this.mapHighlight = new L.GeoJSON(geojson);
            this.mapHighlight.setStyle(this.mapHighlightStyle);
            this.map.addLayer(this.mapHighlight);
            this.map.fitBounds(this.mapHighlight.getBounds());
            
            // Highlight list
            $('.election-list-container ul li a').removeClass('active');
            $('.election-list-container ul li a[data-nid=' + this.race + ']').addClass('active');
            
            // Show election
            var request = this.basePath + this.electionDetailsQuery.replace('%id%', encodeURI(e.nid));
            this.router.message('Loading election details.');
            $.getJSON(request, function(data) {
              thisView.router.removeMessage('Loading election details.');
              if (data.status !== 'error') {
                $('.race-details-container').hide().html(data.output).fadeIn();
                customVotesaverInterfaceImprovements();
                if (!_.isUndefined(Drupal) && _.isFunction(Drupal.attachBehaviors)) {
                  Drupal.attachBehaviors($('.race-details-container'));
                }
              }
            });
          },
          
          resetMap: function() {
            if (_.isUndefined(this.map)) {
              this.map = new L.Map('election-map', this.mapOptions)
                .addLayer(this.mapBaseTiles)
            }
            
            this.map.setView(this.mapCenter, 6);
            this.map.invalidateSize();
            
            if (_.isObject(this.mapHighlight)) {
              this.map.removeLayer(this.mapHighlight);
            }
          },
          
          updateCenterMap: function() {
            if (_.isObject(this.marker)) {
              this.marker.setLatLng(new L.LatLng(this.lat, this.lon));
            }
            else {
              this.marker = new L.Marker(new L.LatLng(this.lat, this.lon));
              this.map.addLayer(this.marker);
            }
          }
        });
        
        // Main router and workspace for actions
        var Workspace = Backbone.Router.extend({
          routes: {
            'search': 'search',
            'location/:location': 'location',
            'location/:location/:race': 'location',
            '*default': 'defaultRoute'
          },
        
          initialize: function() {
            this.searchView = new SearchView({ router: this });
            this.resultsView = new ResultsView({ router: this });
            this.messages = [];
          },
        
          defaultRoute: function() {
            this.navigate('/search', { trigger: true, replace: true });
          },
        
          search: function() {
            this.open = 'search';
            this.searchView.show()
          },
        
          location: function(location, race) {
            var openChange = (this.open != 'location');
            this.open = 'location';
            this.resultsView.show(location, race, openChange);
          },
          
          error: function(message) {
            $('.messages.error').html(message).fadeIn().delay(3000).slideUp();
          },
          
          message: function(message, type) {
            type = (_.isUndefined(type)) ? 'loading' : type;
            this.messages.push(message);
            var index = _.indexOf(this.messages, message);
            $('<span>').attr('data-id', index).addClass(type).html(message + ' ').appendTo('.app-messages');
          },
          
          removeMessage: function(message, type) {
            type = (_.isUndefined(type)) ? 'loading' : type;
            var index = _.indexOf(this.messages, message);
            
            // Special case for removing all errors
            var selector = (message === 'all' && type === 'error') ? 
              '.app-messages span.error' : '.app-messages span[data-id=' + index +']';
            $(selector).slideUp(function() {
              $(this).remove();
            });
          }
        });
        
        // Election output gets changed with JS so we duplicate that here :(
        var customVotesaverInterfaceImprovements = function() {
          var pClass = 'votesaver-interface-processed';
      
          // Don't use context, as the context is the form when submitted
          $('#votesaver-vote-form:not(.' + pClass + ')').each(function() {
            $(this).addClass(pClass);
            
            var selector;
            var cCount = 0;
            var separators = 0;
            
            // Remove any selected notations
            $('.votesaver-select').remove();
            
            // The structure of two node reference is really hard to deal with on a CSS, and JS
            // level, so let's put them together.  This is really hacky.
            $('<div>').addClass('candidate-container').prependTo('.node-type-elections_election .fieldlayout-region-body-detail');
            $('.field-field-elections-incumbents > .field-label')
              .prependTo('.field-field-elections-incumbents > .field-items > .field-item:first-child');
            $('.field-field-elections-candidates > .field-label')
              .prependTo('.field-field-elections-candidates > .field-items > .field-item:first-child');
            // Now take and put into the container
            selector = '.field-field-elections-candidates > .field-items > .field-item, .field-field-elections-incumbents > .field-items > .field-item';
            cCount = $(selector).size();
            $('.candidate-container').addClass('grid-' + cCount);
            $(selector).each(function() {
              var clone = $(this).clone();
              $(clone).appendTo('.candidate-container');
              $(this).remove();
              
              // Add separator
              if (separators < cCount - 1) {
                $('<div>').addClass('candidate-separator').html('vs').appendTo('.candidate-container');
              }
              separators++;
            });
            
            // Hide the regular form
            $('#votesaver-vote-form div *:not(.messages)').hide();
          });
        };
          
        // When ready, make the magic happen
        $(document).ready(function() {
          // Start application
          var workspace = new Workspace();
          Backbone.history.start();
        });
      })(jQueryCustom, window);
    </script>
  </div>
  <!-- END: Embeddable -->

</div>
</body>
</html>